package main

import (
	"fmt"
	"os"
)

func test(code string, input, expected []int64) {
	ic := parseString(code)
	ic.init()
	output := ic.interp(input)
	if len(output) != len(expected) {
		fmt.Printf("FAIL: %s: %d != %d\n", input, len(output), len(expected))
		return
	}
	for i := range expected {
		if output[i] != expected[i] {
			fmt.Printf("FAIL: %s: %d: %d != %d\n", input, i, output, expected)
			return
		}
	}
}

func main() {
	if len(os.Args) < 2 {
		test("1002,4,3,4,33", []int64{}, []int64{})
		test("1101,100,-1,4,0", []int64{}, []int64{})
		test("1101,100,-1,4,0", []int64{}, []int64{})
		test("3,9,8,9,10,9,4,9,99,-1,8", []int64{8}, []int64{1})
		test("3,9,8,9,10,9,4,9,99,-1,8", []int64{9}, []int64{0})
		test("3,3,1108,-1,8,3,4,3,99", []int64{8}, []int64{1})
		test("3,3,1108,-1,8,3,4,3,99", []int64{9}, []int64{0})
		test("3,12,6,12,15,1,13,14,13,4,13,99,-1,0,1,9", []int64{0}, []int64{0})
		test("3,12,6,12,15,1,13,14,13,4,13,99,-1,0,1,9", []int64{8}, []int64{1})
		test("3,3,1105,-1,9,1101,0,0,12,4,12,99,1", []int64{0}, []int64{0})
		test("3,3,1105,-1,9,1101,0,0,12,4,12,99,1", []int64{8}, []int64{1})
		test("3,21,1008,21,8,20,1005,20,22,107,8,21,20,1006,20,31,1106,0,36,98,0,0,1002,21,125,20,4,20,1105,1,46,104,999,1105,1,46,1101,1000,1,20,4,20,1105,1,46,98,99", []int64{7}, []int64{999})
		test("3,21,1008,21,8,20,1005,20,22,107,8,21,20,1006,20,31,1106,0,36,98,0,0,1002,21,125,20,4,20,1105,1,46,104,999,1105,1,46,1101,1000,1,20,4,20,1105,1,46,98,99", []int64{8}, []int64{1000})
		test("3,21,1008,21,8,20,1005,20,22,107,8,21,20,1006,20,31,1106,0,36,98,0,0,1002,21,125,20,4,20,1105,1,46,104,999,1105,1,46,1101,1000,1,20,4,20,1105,1,46,98,99", []int64{9}, []int64{1001})
	} else {
		ic := parseFile("input/05.txt")

		// Part 1
		ic.init()
		out := ic.interp([]int64{1})
		fmt.Printf("%d\n", out)

		// Part 2
		ic.init()
		out = ic.interp([]int64{5})
		fmt.Printf("%d\n", out)
	}
}
