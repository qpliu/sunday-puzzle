2021-02-19 Riddler Classic
==========================
The center of mass of a block where the center is at
<img src="https://render.githubusercontent.com/render/math?math=x"> is
<img src="https://render.githubusercontent.com/render/math?math=x">.

The center of mass of a tower of blocks where the centers are at
<img src="https://render.githubusercontent.com/render/math?math=x_i"> is
<img src="https://render.githubusercontent.com/render/math?math=\langle x_i\rangle">.

Let the length of each block be 2.

Each additional block is placed such that
<img src="https://render.githubusercontent.com/render/math?math=x_i - 1 \le x_{i %2b 1} \le x_i %2b 1">

When
<img src="https://render.githubusercontent.com/render/math?math=|x_i - \frac1{n-i}\sum_{j=i %2b 1}^nx_j| > 1">
for some
<img src="https://render.githubusercontent.com/render/math?math=i"> and some
<img src="https://render.githubusercontent.com/render/math?math=n > i">,
the tower collapses after having placed
<img src="https://render.githubusercontent.com/render/math?math=n"> blocks.

Let
<img src="https://render.githubusercontent.com/render/math?math=D_i = x_i - x_{i-1}">,
where
<img src="https://render.githubusercontent.com/render/math?math=-1 \le D_i \le 1">.

For each block, there is a range
<img src="https://render.githubusercontent.com/render/math?math=D_{i,min} \le D_i \le D_{i,max}">
for which the tower does not collapse.  The chance that it does collapse is
<img src="https://render.githubusercontent.com/render/math?math=1 - \frac{D_{i,max} - D_{i,min}}2">.

<img src="https://render.githubusercontent.com/render/math?math=D_{i,max}"> and
<img src="https://render.githubusercontent.com/render/math?math=D_{i,min}"> are
functions of
<img src="https://render.githubusercontent.com/render/math?math=D_j"> where
<img src="https://render.githubusercontent.com/render/math?math=j = 1, 2, .. i - 1">.

<img src="https://render.githubusercontent.com/render/math?math=D_{2,max} = 1">

<img src="https://render.githubusercontent.com/render/math?math=D_{2,min} = -1">

Considering the top
<img src="https://render.githubusercontent.com/render/math?math=n"> blocks,
if
<img src="https://render.githubusercontent.com/render/math?math=|D_{i-n} + \frac{n-1}nD_{i-n %2b 1} + \frac{n-2}nD_{i-n %2b 2} + ... + \frac1nD_i| > 1">,
the tower collapses.  Considering the intersection of the range of
<img src="https://render.githubusercontent.com/render/math?math=D_i"> where the tower does not collapse for all
<img src="https://render.githubusercontent.com/render/math?math=1 < n < i-1">
gives
<img src="https://render.githubusercontent.com/render/math?math=D_{i,min}"> and
<img src="https://render.githubusercontent.com/render/math?math=D_{i,max}">.

Integrating,
<img src="https://render.githubusercontent.com/render/math?math=\langle n\rangle = \int_{-1}1\frac{dD_2}2(3(1-\frac{D_{3,max}-D{3,min}}2) + \int_{D_{3,min}}^{D_{3,max}}\frac{dD_3}2(4(1-\frac{D_{4,max}-D{4,min}}2) + \int_{D_{4,min}}^{D_{4,max}}\frac{dD_4}2(...)))">.

<img src="https://render.githubusercontent.com/render/math?math=D_{3,min} = max(-1,-2-2D_2)"> and
<img src="https://render.githubusercontent.com/render/math?math=D_{3,max} = min(1,2-2D_2)">.

<img src="https://render.githubusercontent.com/render/math?math=D_{4,min} = max(-1,-2-2D_3,-3-3D_2-2D_3)"> and
<img src="https://render.githubusercontent.com/render/math?math=D_{4,max} = min(1,2-2D_3,3-3D_2-2D_3)">.

<img src="https://render.githubusercontent.com/render/math?math=D_{5,min} = max(-1,-2-2D_4,-3-3D_3-2D_4,-4-4D_2-3D_3-2D_4)"> and
<img src="https://render.githubusercontent.com/render/math?math=D_{5,max} = min(1,2-2D_4,3-3D_3-2D_4,4-4D_2-3D_3-2D_4)">.

Then, there's some insight on how to do the general case that I don't have, but I'll try doing the first two terms to see where that leads.

The first term is
<img src="https://render.githubusercontent.com/render/math?math=\int_{-1}1\frac{dD_2}2(3(1-\frac{D_{3,max}-D{3,min}}2))">.
When <img src="https://render.githubusercontent.com/render/math?math=D_2 < -1/2">,
<img src="https://render.githubusercontent.com/render/math?math=D_{3,min} = -2-2D_2">.
When <img src="https://render.githubusercontent.com/render/math?math=D_2 > 1/2">,
<img src="https://render.githubusercontent.com/render/math?math=D_{3,max} = 2-2D_2">, which works out to 3/8, so there's a 1/8 chance of collapse on the third block.

The second term is
<img src="https://render.githubusercontent.com/render/math?math=\int_{-1}1\frac{dD_2}2\int_{D_{3,min}}^{D_{3,max}}\frac{dD_3}2(4(1-\frac{D_{4,max}-D{4,min}}2))">.  Break it into the 3 regions of
<img src="https://render.githubusercontent.com/render/math?math=D_2">,
<img src="https://render.githubusercontent.com/render/math?math=\int_{-1}{-1/2}\frac{dD_2}2\int_{-2-2D_2}^{1}\frac{dD_3}2(4(1-\frac{D_{4,max}-D{4,min}}2)) %2b \int_{-1/2}{1/2}\frac{dD_2}2\int_{-1}^{1}\frac{dD_3}2(4(1-\frac{D_{4,max}-D{4,min}}2)) %2b \int_{1/2}1\frac{dD_2}2\int_{-1}^{2-2D_2}\frac{dD_3}2(4(1-\frac{D_{4,max}-D{4,min}}2))">.
For 
<img src="https://render.githubusercontent.com/render/math?math=D_2 < 0, D_3 > 0, D_4 > 0">, or
<img src="https://render.githubusercontent.com/render/math?math=D_2 > 0, D_3 < 0, D_4 < 0">, it reduces to the second term, but I don't see how that simplifies the calculation.

It's getting more complicated than I want to deal with, so I give up.
