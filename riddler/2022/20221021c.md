2022-10-21 Riddler Classic
==========================
There are
${54\choose 16}16! = 54!/38! = 441364655428084750602240000 \approx 4.4e26$
possible boards, which is much more than 1000.

For a given board, there is a 16/54 probability that the first card is on
the board.

If the first card is not on the board, it cannot be a winner with the fourth
card, and can only be a winner if there are four cards on the board after the
fifth card.  The probability of having four cards on the board after the
fifth card is
$38/54 \times 16/53 \times 15/52 \times 14/51 \times 13/50 = 532/121635$.

If the first card is on the board and the second card is not on the board,
the probability of having four cards on the board after the fifth card is
$16/54 \times 37/53 \times 15/52 \times 14/51 \times 13/50 = 518/121635$.

Similarly, the probability of having four cards on the board without having
the third card is 504/121635.

The probability of having four cards on the board without having the fourth
card is 490/121635.

In total, the probability of having four cards on the board after the fifth
card while having three cards on the board after the fourth card is
2044/121635.

The probability of having four cards on the board after the fourth draw is
140/24327.

Let $p$ be the probability of being a winner with four cards on the board.

Let $q$ be the probability of the fifth draw making a
winner, given four non-winning cards on the board.

Let $P$ be the probability of a single given board not winning with the
fourth card and winning with the fifth card.

$$ P = 2044p/121635 + 140(1-p)q/24327 $$

Calculating $p$
---------------
There are ${16\choose 4} = 1820$ ways four cards can be on a board, and
18 of them are winners, making $p = 18/1820 = 9/910$.

Calculating $q$
---------------
There are ${16\choose 3} = 560$ ways three cards can be on a board, and
$18 \times 4$ of them are 3/4ths of a winning pattern.  And the remaining
card could make it 3/4ths of another winning pattern.

There are 1802 non-winning ways four cards can be on a board.  Some of them
can be winners with only 1 of the 50 remaining cards.  Some of them can be
winners in two different ways with one of 2 of the 50 remaining cards,
and some of can be winners in three different ways with one of 3 of the 50
remaining cards.

There are 48 non-winning ways four cards can be on a board with 3 of the
corners.  16 of them also have 3 in a row or a column.  So
$q = 48/1802 \times 1/50 + 16/1802 \times 1/50 + \ldots$.
```
 OxxO
 x___
 x___
 O__+
```
Here `O` marks a card on the board, `+` marks where the winning 5th card
goes.  `x` marks where, if there's a card, there's an additional winning
5th card, `y` marks where, if there's a card, there are two additional
winning 5th cards, and `.` marks ways already counted.

There are 192 non-winning ways four cards can be on a board with 3 on a
single edge.  16 of them also have 3 of the corners, so there are 176 ways
not previously counted.  40 of them also make 3/4ths of a 2x2 square,
and another 8 of them also make 3/4ths of a second 2x2 square,
so $q = \ldots + 176/1802 \times 1/50 + 40/1802 \times 1/50 + 8/1802 \times 1/50 \ldots$.
```
 O+OO  +OOO
 __xx  _xyx
 ____  ____
 .__.  ____
```

There are 192 non-winning ways four cards can be on a board with 3 of them
in a single column or row that is not an edge.  80 of them also make
3/4ths of a 2x2 square, and 16 of them also make 3/4ths of a second 2x2
square, so
$q = \ldots + 192/1802 \times 1/50 + 80/1802 \times 1/50 + 16/1802 \times 1/50 \ldots$.
```
 __xx  _xyx
 O+OO  +OOO
 __xx  _xyx
 ____  ____
```

Counting the ways when making 3/4ths of a 2x2 square in a corner, there
are 192 ways, minus 64 ways already counted, plus 16 ways that make
3/4ths of a second 2x2 square, so
$q = \ldots + 128/1802 \times 1/50 + 16/1802 \times 1/50 + \ldots$.
```
 OO..  +Ox_  O+__
 O+__  OO..  OO..
 .___  x.__  .x__
 .___  _.__  .___
```

Counting the ways when making 3/4ths of a 2x2 square in the middle of an
edge, there are 192 ways, minus 80 ways already counted, plus 8 ways that
make 3/4ths of a second 2x2 square, so
$q = \ldots + 112/1802 \times 1/50 + 8/1806 \times 1/50 + \ldots$.
```
 .OO.  _+O.
 .O+_  .OO.
 _.__  _x._
 _.__  __._
```

Counting the ways when making 3/4ths of a 2x2 square in the middle,
there are 48 ways minus 24 ways already counted, so
$q = \ldots + 24/1802 \times 1/50$.
```
  _.__
  .O+_
  .OO.
  _.._
```

Putting it together,
$q = (48+16 +176+40+8 +192+80+16 +128+16 +112+8 +24)/90100 = 216/22525$.

That makes $P = 194/878475 \approx 2.20837e-4$, the probability of one board
winning on the fifth draw without winning on the fourth draw.

Then, if there are 1000 boards, the probability of exactly one winner with
the fifth card is $P(1-P-140p/24327)^{999} \approx 1.6732e-4$, where
$140p/24327 = 2/35139 \approx 5.69168e-5$ is the probability of one board
winning on the fourth draw.

The exact number is 897337531336111207483351730599182212900647293001459869327032192996012590752421842605356490437499103171797038709977651473105120145738183288528148469368600371623830520300761804820925558776397799939925590513594250880515726004526446497580264806303849421435675503503683830817753906242643979014319189778142444074544332119920574306857038826768388784181008685608015246542192383820727238610066428709654686387803363999459985110809401289762590172848782835294805484945742263799108705292286905907518671445635952031442276169200194636756199966855219856316724021218736548412677457247675091431049049722674767126204980256177461995420696152111956951740597921638358801201540666118759757702747560895297103320188774289357892092045016866711039609180598443481440881578507774515981122280813141588410698891197520129152793194487345291487025974361574509802158047330293880252775962116580276909842405357002324680629897379118208874761069473985453119879910413095077049164478417566940837932503225022464745381266812091052623395532263415197307084741336844789636955264241593957177116781381385674024243371330358899533244221300284823351887536137718653657949394051399913706371847825898184502758741607650786574446996724739824757247967608553004291258655371165062807695973998153745807700092007882729859010504350906506124025470436461657759953429580676781450518872300320600776809676186242338054905803115426827256217583869629239168303920631038590018079353437822906509996749393245158626862413777037063735327092802250222858239230346586678572319092440912893201325742035782796076179825327824663207301268683809203341163168951769088512023956521648099386250555316305390931906223696364690315268823726042804472923182090747074575564566469054311874150917255190081483172410938850950076426329462555956708545513987262418303144421275543696548179447384920560971964271972152232070946413898149439283231958404417776537574873892083021384957652836343707315381012789180348966999485952029050518556936172167388697124900862698690514098311508770884489074452679528852172582071865594436968355631935369839258256095478346976865085812460958376754033877337415168564501134109486098435120203584966555517526913966154367261170940384145698383477306742036554395959367488644394006129043518029043119910105565119578678766011716400626680743181730468583249342687149091219295978232090903895662014162835004806094952967643433284713588315452079604711113438281049506113798849751908629999538601246265501604278706735343668650230025165948897716532779949867337311685097461555134493382923305161528638897742740656409583456237515098195460068659293910551943997966016030283526632322326444972899417541495965490731867153633428775294887308345706778546573756977906210595397092989000685228028671623721277039782575654027362677858951237595117846201512167294638401715156960133603435974230687372189492067765636213397861262085543990722430492793488016018543009696370658723548002621549955683729602906754154671151094861866495563520188488307998249271192646104818214989452407837795337694384202261544406940189486513178638002740224667314408673418697893426913259173213905005870043589957168233093828186694698270519168348443293377757821886442186934336142476557915316727195368800318076626315572345758978135818446427607631941784754470871641419801403391877344899559166378964019274146197606416634437813236057886271754880679954546518741486806538627223082123418257090618626238721754962563761557605962145636457928377587727232522260173971374251674263650292749544648724603605657886936796897444245727399862348855039393879321620961502364182759969410232687026443963888020440208632337978319539846338777248642762605921327145453746522347778147538426525728801679091849747829791486463184907979310258904489230900011658974843690605573580244266242883207414972475209102248645283639101221596914885415134096299267649985499112861373786730363187469944828747355104459973187059901475338829649697980972199433822287513593290986382793987965075540262877498287074522073046278211434083320211051010271529914593686714283062462790578121120721258916727661300668105524892176519683230078527750434697168144289686239603494117415132622782076410766295489306276084515572279946586957581304034079016432233674355889212582981759144004902059009312968686425182986637018612827317601969696029981918592875920126711143233169412178696247038920066962479950871596763706408030155751114245891040562113892572111072135606389747745992275746932557443445859194126043466355094982325562971843471118821772899521125761789998616453591988924782683402573282830972605686997437182193475358203833447880316302838078434351903782610141495741006656480086744988182639565581351353865020166367218082578568759996232808447317674439214215601719259598007507752099975455704911353914722302470048812611188996810234961936275666513863219049815359273865938791250054468275261668181035413218483248488289043302304593566525134905729594677215584792053206075420169773741067269157725296315857400408538046212865128670112542384533546590313188225433088360433655664397120380434556022437144145079760062707602972714658703062217284223565189863848888028102137671987545625584108985308916939291528666187601410448495691424036629117210203876460837901334573669421926417093544150362568425363768546683898692446180219505643114362871640940365588408627092064477751068349270923320914189762586351613399514273461449413883303558594349818033747252806668197986356053405503451096699376411198761602800216383544965427065597692590496665692894894003740284567051694097930696056206353819039596556037750470322493591214207239447461425014722944991535263481215841567856749976008830209499427491749922686407520127312462254654784920259110229431507839280822975119332331262428760481965898134979475974431956234443214554281410542039242867666067355042129036470554903141544836114751090927045615611152244674905447442145979472628398563710085691081767314353116373882344267716597211711881437429186469296676633972334030540722460217247345881393777981010615502138417278465820963818136740267318315096651279868174/5362986177265028901400040686052971107246958771447504262423198092153880539848066785195324215369551868038344371732319065281151332578772701414941266423035265633450336797043362421897905813454523336547720714746570697203157995356121995032773118949569915641671089885387119849634899075072044062220430667621297852930870380469158213454002714706214399829144581586368543206669574903174195101486359147776963080715027628006458495129509627912024177883095205686087671215307827810701962698992703842009145831851033854733183941897158778472064469347868132090840896518494644137006968380988765682160927592140908342666044230198429906718295318145076254047457340995853361394010427572466261581832902817889423076556912332539241729323477003916951601027292426807635439050123805096345985931557736496640516813211465182273610806736928609004940164567269339897605943438106424765087333202848303525652537463293361136664307183186981886720118137757945836765081163763868449955911229244085661325635251659839146944753681336856974113604249760941227038906557343517210518026257245008635544131081346244153426821411033505252929102987281672827096886703201683553565287238545839736208605651210687661007786098422052654483738140913136053147245266156619720539415421473363323076201137047033093532187766396872107730762404884149522922978590151072850851301126338549848309211939310901529933012219223948240750865234415638771265218104407782542596470683305652417171833623833317320088788689434415109127848770104268739380020129156544051026071048693209064391477044049539983968028912225812632761170453417111715384241950804348885165102635387499871133217174755313278578385612434472233920459772005611532436456046189706588383335873176797275407296260727431450755236992334300867316576332146900422657910781829583158846465574913162609185544485507231464507225600829458732279045786729481689387527105831622551187622042650971361761764446764372905602036538649848245428858003998193203404633751773653760477796134087211627597769293347868413316229759929615325046008852362917523215357047033300858346764992184194279366342950337137960431920535329836367851902337316622681663177200797140302892578393586567220957091115810534736716707509743181753314235340779411386938122429879935656122525269512787847975417820273644672704500787734859378826682755008301392349377650189661531471726469400329260642749256690389269013871184925688365944611757501673159821238961383325558909378852950985822390698332264010244128182980758685657182494154263993763890874964142634265186077992388618388120544204185587443700147553047589308536759135216072989884175858414251919587061685190791614952460088231488431000321110983414047613858818014197274601557886542494781575816698773972801342277559794643893698669514901405919696515030720882913917715787678864369632800530370034781050201186906156573631248917402438733835981987778038037742302812034499749536446158354481677581188149362065637856205037630635245027239050178741086976483161776020126974953469880057927911723410303988735605263403348034099802615198970090998464221520088005330138804217665378287403245404150921701993176919662399682927779334214435079416398118272079687293969452856945467934472956711018676162601026366851927886844790069460644596717884558499819656268892488710595801682743496051333612971011629129991587681943793362431613663120644346511960820080205494169384967030933404450810211069725107438508596374153005797184033936873605221259447172972934681265070494322260563005575649588504356441181596784262416830341125706556847208157121027409761495027391018275365344543254654744484046918824906739428270547142056095520710665121719716969333758006902909253877859785214677981437686519162383526254698139806933374088579930097751965118630196072782443558226492224182021341110241654264892192652828504002673937768666526720389994464103002536582376429739447713149323064508489115255652648063912161239984319996993960903213322433087248929035475552378706247324478116090944637345911922228829103009798882041254416825692257270903244420711600882943454923778515084497921240801285910750503713014186954937613774530778914331650062801723343248995831778595464010725535886272478523171503924596355368263830187833630912938876118899260705618604005157649656656715696144171437497362863249236184756429780447795776663162327347907384473551237036068419831646251914597805144952518264419534285153250166462294897665532678879470116019879891994839276863559798954938189257332139475515919196297143477147520771219403614110526990898900091629708111469740100997390423868253844496573440607508086696886277638278768904318731093521733836086230372239690661039588426990212323974974057165619972917560365241069268390361164181933832676945627804519672893978058088243959571850080352851893720046102874438022154179995809333702502222849115942381283316089652980147625249163155138810035108366815232703620324413274323738122235737641678827799613225065990024764274379890053500335478331688456161355978031820895611509348323571643724938255384719939356375345762166182263858979594288019644948918505628185827588335260154759612621019369611665048064502165447099932390281204713829331010518633648959416176003614989124987804747692346351155765712157641221720353966458189351745993749401152414670493960061141077895031007680831400399103380437961936365519966437411808210189047157832786167206810322244374065618891028759070329773351710747165999882653705798301784219111185909274291054730841574547464607714747233863859448980815154931726234543351960070739699158282058469040302474072814072133086918264877834980448702810494883680570998350807581403786348794569097356189774911437431443028513956030320840910928437888949708022479947093076665828236234588336713436158861029482981215021081913758327513776112460004130620822940447211363871252597308132721775837248593784759148311801727244576407347901350169922800709854523394488699606893205943076131044464329195365567013627036260627537716103863185533010893627062528558713130893992351790947161567796519400960730091919938366932553430732610877385013736784458160400390625.

What I got wrong
----------------
I need to divide my answer by the probability that there were no winners
among the 1000 after the fourth draw to get the answer to what the actual
problem is, which would change my answer by about 6%.  I also need to
multiply by 1000 because any of the 1000 could be the winner.
